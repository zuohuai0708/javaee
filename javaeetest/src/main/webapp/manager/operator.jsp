<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link href="../css/global.css" rel="stylesheet" type="text/css" /><link href="../css/tablesorter.css" rel="stylesheet" type="text/css" /><script type="text/javascript" src="../js/jquery.js"></script><script type="text/javascript" src="../js/json2.js"></script><script type="text/javascript" src="../js/jquery.artDialog.js?skin=opera"></script><script type="text/javascript" src="../js/base.js"></script><script type="text/javascript">	$(document).ready(function() {		init();	});	var addUrl = "../admin/operators/";	var deleteUrl = "../admin/operators/";	var getUrl = "../admin/operators/";	function init() {		search();	}	function search() {		$.ajax({			dataType : 'json',			type : "GET",			url : getUrl,			cache : false,			timeout : 60000,			success : function(json) {				showList(json);			},			error : function(error) {				alert("查询失败");			}		});	}	var cache_data;	function showList(list) {		$('#table > tbody > tr ').remove();		var index = 0;		cache_data = list;		console.log(list);		for ( var i = 0; i < list.length; i++) {			var row = "<tr><td>" + list[i].id + "</td>";			row += "<td>" + list[i].name + "</td>";			row += "<td>" + list[i].nick + "</td>";			row += "<td>" + list[i].key + "</td>";			var ips = list[i].allowIps.join("<br>");			row += "<td>" + ips + "</td>";			var acs = list[i].testAccounts.join("<br>");			row += "<td>" + acs + "</td>";			row += "<td>" + (list[i].retry ? "是" : "否") + "</td>";			row += "<td>" + (list[i].addition ? "是" : "否") + "</td>";			var time = list[i].informations.createTime;			row += '<td><input type="button" value="编辑" onclick="edit(' + index + ');" />';			row += '<input type="button" value="删除" onclick="removeDate(\'' + list[i].id + '\');" /></td>';			row += "</tr>";			$('#table > tbody:last').append(row);			index++;		}	}	function removeDate(id) {		var id = encodeURIComponent(id);//.replace(":","%3a");		art.dialog({			content : '确定要删除吗？',			ok : function() {				$.ajax({					dataType : 'json',					type : "DELETE",					url : deleteUrl + id + "/api-operator",					success : function() {						search();					}				});			},			cancelVal : '关闭',			cancel : true		});	}function edit(index){	if(cache_data==null || cache_data[index]==null)	{		alert("出错");		return;	}	var value=cache_data[index]; 	$("#edit_id").val(value.id);	$("#edit_name").val(value.name);	$("#edit_nick").val(value.nick);	$("#edit_key").val(value.key);	$("#edit_allowIps").val(value.allowIps.join("\n"));	$("#edit_testAccounts").val(value.testAccounts.join("\n"));	$("#edit_retry").attr("checked", value.retry);	$("#edit_addition").attr("checked", value.retry);	showWinodw("showAlert1",function(a){		var id = $("#edit_id").val();		var name = $("#edit_name").val();		var nick = $("#edit_nick").val();		var key = $("#edit_key").val();		var ips = textarea2list($("#edit_allowIps").val());		var accounts = textarea2list($("#edit_testAccounts").val());		var retry = ($("#edit_retry").attr("checked") == 'checked');		var addition = ($("#edit_addition").attr("checked") == 'checked');		if(name=='' || id=='' ||   key=='' )		{			alert("请填写完整信息!");			return;		}					var obj={			id:id, 			name:name, 			nick:nick,			key:key,			retry:retry,			addition:addition,			allowIps:ips,			testAccounts:accounts,			testPlayers:[],			testTargets:[],			informations:""		};				console.log(obj);		$.ajax({				dataType: 'json',				type : "PUT",				url : addUrl+ id + "/api-operator",				contentType : "application/json",				data : JSON.stringify(obj),				success : function() {					search();					a.close();				},error:function()				{					alert("添加失败，服务器标识不能重复");				}		});				});}function addWindow(){	$("#add_id").val('');	$("#add_name").val('');	$("#add_nick").val('');	$("#add_key").val('');	$("#add_allowIps").val('');	$("#add_testAccounts").val('');	$("#add_retry").attr("checked", false);	$("#add_addition").attr("checked", false);		showWinodw("addOperatorDiv",function(a){		var name = $("#add_name").val();		var nick = $("#add_nick").val();		var id = $("#add_id").val();		var key = $("#add_key").val();		var ips = textarea2list($("#add_allowIps").val());		var accounts = textarea2list($("#add_testAccounts").val());		var retry = ($("#add_retry").attr("checked") == 'checked');		var addition = ($("#add_addition").attr("checked") == 'checked');;		if(name=='' || id=='' ||   key=='' )		{			alert("请填写完整信息!");			return;		}					var obj={			id:id,			name:name,			nick:nick,			key:key,			retry:retry,			addition:addition,			allowIps:ips,			testAccounts:accounts,			testPlayers:[],			testTargets:[],			informations:""		};		console.log(obj);		$.ajax({				dataType: 'json',				type : "POST",				url : addUrl + id + "/api-operator",				contentType : "application/json",				data : JSON.stringify(obj),				success : function() {					search();					a.close();				},error:function()				{					alert("添加失败，服务器标识不能重复");				}		});				});}</script><style>.tablecls tr,.tablecls td{border: 1px solid #D8D8D8;text-align:center;}.tablecls td input,.tablecls td textarea{	width:350px;	text-align:left;}.tablecls td textarea{	height:110px;}</style></head><body><div class="mainbox">	<p>		<a href="../index.html">返回</a>		<a href="servers.jsp">服务器列表</a> 		<a href="javascript:;" onclick="addWindow();return false;">添加运营商</a> 		<font color="red">添加和修改功能只用于测试,数据会在同步管理后台后丢失</font>	</p>  <div class="contant" style="width:99%;">	<div class="line" style="width:100%"></div>   <div class="tablebox01"> 	<table id="table" class="tablesorter">		<thead>			<tr>				<th style="width: 60px;">运营商ID</th>				<th style="width: 60px;">运营商标识</th>				<th style="width: 60px;">运营商名称</th>				<th style="width: 160px;">密匙</th>				<th style="width: 160px;">许可IP</th>				<th style="width: 160px;">测试账号</th>				<th style="width: 80px;">自动补单</th>				<th style="width: 80px;">扩展开启</th>				<th style="width: 160px;">操作</th>			</tr>		</thead>		<tbody> </tbody>		<tfoot>				<tr>					<td></td>				</tr>		</tfoot>	</table>	  </div>    </div>    <div class="kongge_box" ></div></div><!-- 添加新运营商 --><div id="addOperatorDiv" style=" width:600px;display: none;">			<legend><em>添加新运营商</em></legend>		<table class="tablecls">			<tr><td><label>运营商ID：</td><td><input type="text" id="add_id" name="add_id" /></label></td></tr>			<tr><td><label>运营商标识：</td><td><input type="text" id="add_name" name="add_name" /></label></td></tr>			<tr><td><label>运营商名称：</td><td><input type="text" id="add_nick" name="add_nick" /></label></td></tr>			<tr><td><label>充值密匙：</td><td><input type="text" id="add_key" name="add_key" /></label></td></tr>			<tr><td><label>充值许可IP：</td><td><textarea id="add_allowIps" name="add_allowIps"></textarea></label></td></tr>			<tr><td><label>测试账号列表：</td><td><textarea id="add_testAccounts" name="add_testAccounts"></textarea></label></td></tr>			<tr><td><label for="retry">自动补单：</td><td></label><input id="add_retry" name="add_retry" type="checkbox" value="1"/></td></tr>			<tr><td><label for="addition">扩展开启：</label></td><td><input id="add_addition" name="add_addition" type="checkbox" value="1"/></td></tr> 		</table>	</div><div id="showAlert1" style="display:none;max-height:550px;overflow:auto;  overFlow-x:hidden; ">			<legend><em>修改运营商</em></legend>		<table class="tablecls">			<tr><td><label>运营商ID：</td><td><input type="text" id="edit_id" name="edit_id" readonly /></label></td></tr>			<tr><td><label>运营商标识：</td><td><input type="text" id="edit_name" name="edit_name" /></label></td></tr>			<tr><td><label>运营商名称：</td><td><input type="text" id="edit_nick" name="edit_nick" /></label></td></tr>			<tr><td><label>充值密匙：</td><td><input type="text" id="edit_key" name="edit_key" /></label></td></tr>			<tr><td><label>充值许可IP：</td><td><textarea id="edit_allowIps" name="edit_allowIps"></textarea></label></td></tr>			<tr><td><label>测试账号列表：</td><td><textarea id="edit_testAccounts" name="edit_testAccounts"></textarea></label></td></tr>			<tr><td><label for="retry">自动补单：</td><td></label><input id="edit_retry" name="edit_retry" type="checkbox" value="1"/></td></tr>			<tr><td><label for="addition">扩展开启：</label></td><td><input id="edit_addition" name="edit_addition" type="checkbox" value="1"/></td></tr> 		</table>	</div></body></html>